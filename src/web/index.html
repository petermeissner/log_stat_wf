<!DOCTYPE html>
<html>
<head>
    <title>WildFly Log Statistics</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="main-container">
        <h1>WildFly Log Statistics</h1>
        
        <div class="content-wrapper">
            <!-- Left Panel: Filters and Settings -->
            <div class="left-panel">
                <!-- Filter Form -->
                <div class="filter-section">
                    <h2>Filter Options</h2>
                    <form id="filterForm">
                        <div class="form-group">
                            <label for="viewMode">View Mode:</label>
                            <select id="viewMode" name="viewMode">
                                <option value="detailed">Detailed (by Logger)</option>
                                <option value="aggregated">Aggregated (Sum by Level)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="level">Level:</label>
                            <select id="level" name="level">
                                <option value="">All Levels</option>
                                <option value="FATAL">FATAL</option>
                                <option value="ERROR">ERROR</option>
                                <option value="WARN">WARN</option>
                                <option value="WARNING">WARNING</option>
                                <option value="INFO">INFO</option>
                                <option value="DEBUG">DEBUG</option>
                                <option value="TRACE">TRACE</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="loggerRegex">Logger Pattern (regex):</label>
                            <input type="text" id="loggerRegex" name="loggerRegex" placeholder="e.g., com\\.example\\..*">
                        </div>
                        <div class="form-group">
                            <label for="minTs">From:</label>
                            <input type="datetime-local" id="minTs" name="minTs">
                        </div>
                        <div class="form-group">
                            <label for="maxTs">To:</label>
                            <input type="datetime-local" id="maxTs" name="maxTs">
                        </div>
                        <div class="form-group">
                            <label for="maxResults">Max Results:</label>
                            <input type="number" id="maxResults" name="maxResults" value="1000" min="1" max="10000">
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="includeMemory" name="includeMemory" checked>
                                Include In-Memory Data
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="includeDB" name="includeDB" checked>
                                Include Database Data
                            </label>
                        </div>
                        <button type="submit" class="btn-primary">Apply Filters</button>
                        <button type="button" class="btn-secondary" id="clearFiltersBtn">Clear Filters</button>
                    </form>
                </div>

                <!-- Auto-Refresh Control -->
                <div class="refresh-section">
                    <h2>Auto-Refresh</h2>
                    <form id="refreshForm">
                        <div class="form-group">
                            <label for="refreshFrequency">Frequency:</label>
                            <select id="refreshFrequency" name="refreshFrequency">
                                <option value="5000">5 seconds</option>
                                <option value="10000">10 seconds</option>
                                <option value="30000">30 seconds</option>
                                <option value="60000">1 minute</option>
                                <option value="300000">5 minutes</option>
                                <option value="600000">10 minutes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="autoRefreshCheckbox">
                                <input type="checkbox" id="autoRefreshCheckbox" name="autoRefresh">
                                Enable Auto-Refresh
                            </label>
                        </div>
                        <button type="button" class="btn-secondary" id="manualRefreshBtn">Manual Refresh</button>
                    </form>
                </div>
            </div>

            <!-- Right Panel: Stats Table -->
            <div class="right-panel">
                <div id="loading" class="loading" style="display: none;">Loading statistics...</div>
                <div id="error" class="error" style="display: none;"></div>

                <!-- Chart Section -->
                <div class="chart-section">
                    <h2>Log Levels Distribution</h2>
                    <div class="chart-container">
                        <canvas id="levelChart"></canvas>
                    </div>
                </div>

                <!-- Table Section -->
                <div class="table-section">
                    <h2 id="tableTitle">Log Statistics</h2>
                    <table id="statsTable" style="display: none;">
                        <thead id="statsTableHead">
                            <tr>
                                <th class="sortable" data-column="HostName">Host<span class="sort-indicator"></span></th>
                                <th class="sortable" data-column="Logger">Logger<span class="sort-indicator"></span></th>
                                <th class="sortable" data-column="Level">Level<span class="sort-indicator"></span></th>
                                <th class="sortable" data-column="N">Count<span class="sort-indicator"></span></th>
                                <th class="sortable" data-column="BucketTS">Bucket Start<span class="sort-indicator"></span></th>
                                <th class="sortable" data-column="FirstSeenTS">First Seen<span class="sort-indicator"></span></th>
                                <th class="sortable" data-column="BucketDuration_S">Bucket Duration (s)<span class="sort-indicator"></span></th>
                                <th class="sortable" data-column="Rate">Rate (msg/hr)<span class="sort-indicator"></span></th>
                            </tr>
                        </thead>
                        <tbody id="statsBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="/app.js"></script>
</body>
</html>
