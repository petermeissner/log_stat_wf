<!DOCTYPE html>
<html>
<head>
    <title>WildFly Log Statistics</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/style.css">
    <script src="/libs/echarts.min.js"></script>
</head>
<body>
    <div class="main-container">
        <h1>WildFly Log Statistics</h1>
        
        <!-- Navigation Tabs -->
        <nav class="nav-tabs">
            <button class="nav-tab active" data-page="dashboard">
                <span class="nav-icon">ðŸ“Š</span>
                <span class="nav-label">Dashboard</span>
            </button>
            <button class="nav-tab" data-page="stream">
                <span class="nav-icon">ðŸ“¡</span>
                <span class="nav-label">Live Stream</span>
            </button>
            <button class="nav-tab" data-page="database">
                <span class="nav-icon">ðŸ’¾</span>
                <span class="nav-label">Database Info</span>
            </button>
            <button class="nav-tab" data-page="system">
                <span class="nav-icon">ðŸ’»</span>
                <span class="nav-label">System Info</span>
            </button>
        </nav>

        <!-- Page: Dashboard -->
        <div class="page-content active" id="page-dashboard">
            <div class="content-wrapper">
            <!-- Left Panel: Filters and Settings -->
            <div class="left-panel">
                <!-- Filter Form -->
                <div class="filter-section">
                    <h2>Filter Options</h2>
                    <form id="filterForm">
                        <div class="form-group">
                            <label for="viewMode">View Mode:</label>
                            <select id="viewMode" name="viewMode">
                                <option value="detailed">Detailed (by Logger)</option>
                                <option value="aggregated">Aggregated (Sum by Level)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="level">Level:</label>
                            <select id="level" name="level">
                                <option value="">All Levels</option>
                                <option value="FATAL">FATAL</option>
                                <option value="ERROR">ERROR</option>
                                <option value="WARN">WARN</option>
                                <option value="WARNING">WARNING</option>
                                <option value="INFO">INFO</option>
                                <option value="DEBUG">DEBUG</option>
                                <option value="TRACE">TRACE</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="loggerRegex">Logger Pattern (regex):</label>
                            <input type="text" id="loggerRegex" name="loggerRegex" placeholder="e.g., com\\.example\\..*">
                        </div>
                        <div class="form-group">
                            <label for="minTs">From:</label>
                            <input type="datetime-local" id="minTs" name="minTs">
                        </div>
                        <div class="form-group">
                            <label for="maxTs">To:</label>
                            <input type="datetime-local" id="maxTs" name="maxTs">
                        </div>
                        <div class="form-group">
                            <label for="maxResults">Max Results:</label>
                            <input type="number" id="maxResults" name="maxResults" value="1000" min="1" max="10000">
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="includeMemory" name="includeMemory" checked>
                                Include In-Memory Data
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="includeDB" name="includeDB" checked>
                                Include Database Data
                            </label>
                        </div>
                        <button type="submit" class="btn-primary">Apply Filters</button>
                        <button type="button" class="btn-secondary" id="clearFiltersBtn">Clear Filters</button>
                    </form>
                </div>

                <!-- Auto-Refresh Control -->
                <div class="refresh-section">
                    <h2>Auto-Refresh</h2>
                    <form id="refreshForm">
                        <div class="form-group">
                            <label for="refreshFrequency">Frequency:</label>
                            <select id="refreshFrequency" name="refreshFrequency">
                                <option value="5000">5 seconds</option>
                                <option value="10000">10 seconds</option>
                                <option value="30000">30 seconds</option>
                                <option value="60000">1 minute</option>
                                <option value="300000">5 minutes</option>
                                <option value="600000">10 minutes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="autoRefreshCheckbox">
                                <input type="checkbox" id="autoRefreshCheckbox" name="autoRefresh">
                                Enable Auto-Refresh
                            </label>
                        </div>
                        <button type="button" class="btn-secondary" id="manualRefreshBtn">Manual Refresh</button>
                    </form>
                </div>
            </div>

            <!-- Right Panel: Stats Table -->
            <div class="right-panel">
                <div id="loading" class="loading" style="display: none;">Loading statistics...</div>
                <div id="error" class="error" style="display: none;"></div>

                <!-- Quick Filter Section -->
                <div class="quick-filter-section">
                    <h3>Quick Filter (Client-Side) <span class="filter-status" id="filterStatus"></span></h3>
                    <div class="quick-filter-controls">
                        <input type="text" id="quickSearchInput" placeholder="Search host, logger, or level..." class="quick-filter-input">
                        <select id="quickLevelFilter" class="quick-filter-select">
                            <option value="">All Levels</option>
                            <option value="FATAL">FATAL</option>
                            <option value="ERROR">ERROR</option>
                            <option value="WARN">WARN</option>
                            <option value="WARNING">WARNING</option>
                            <option value="INFO">INFO</option>
                            <option value="DEBUG">DEBUG</option>
                            <option value="TRACE">TRACE</option>
                        </select>
                        <button type="button" class="btn-clear-filter" id="clearQuickFilter">Clear</button>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="charts-wrapper">
                    <!-- Level Distribution Chart -->
                    <div class="chart-section chart-small">
                        <h2>Log Levels Distribution</h2>
                        <div id="levelChart" class="chart-container-small"></div>
                    </div>

                    <!-- Logger Time-Series Chart -->
                    <div class="chart-section chart-large">
                        <h2>Logger Activity Over Time</h2>
                        <div class="logger-selector-controls" style="display: flex; gap: 10px; align-items: flex-start;">
                            <div>
                                <label style="font-weight: bold; margin-bottom: 5px; display: block;">Loggers:</label>
                                <select id="loggerSelect" class="logger-multiselect" multiple size="1">
                                    <option disabled>Loading loggers...</option>
                                </select>
                            </div>
                            <div>
                                <label style="font-weight: bold; margin-bottom: 5px; display: block;">Levels:</label>
                                <select id="levelSelect" class="logger-multiselect" multiple size="1">
                                    <option value="FATAL">FATAL</option>
                                    <option value="ERROR">ERROR</option>
                                    <option value="WARN">WARN</option>
                                    <option value="WARNING">WARNING</option>
                                    <option value="INFO" selected>INFO</option>
                                    <option value="DEBUG">DEBUG</option>
                                    <option value="TRACE">TRACE</option>
                                </select>
                            </div>
                            <div style="display: flex; flex-direction: row; gap: 5px; margin-top: 23px;">
                                <button type="button" class="btn-chart-control" id="selectTopLoggers">Top 5</button>
                                <button type="button" class="btn-chart-control" id="selectAllLoggers">All Loggers</button>
                                <button type="button" class="btn-chart-control" id="selectAllLevels">All Levels</button>
                                <button type="button" class="btn-chart-control" id="clearLoggers">Clear Loggers</button>
                                <button type="button" class="btn-chart-control" id="clearLevels">Clear Levels</button>
                            </div>
                        </div>
                        <div id="timeSeriesChart" class="chart-container-large"></div>
                    </div>
                </div>

                <!-- Table Section -->
                <div class="table-section">
                    <h2 id="tableTitle">Log Statistics</h2>
                    <table id="statsTable" style="display: none;">
                        <thead id="statsTableHead">
                            <tr>
                                <th class="sortable" data-column="HostName">Host<span class="sort-indicator"></span></th>
                                <th class="sortable" data-column="Logger">Logger<span class="sort-indicator"></span></th>
                                <th class="sortable" data-column="Level">Level<span class="sort-indicator"></span></th>
                                <th class="sortable" data-column="N">Count<span class="sort-indicator"></span></th>
                                <th class="sortable" data-column="BucketTS">Bucket Start<span class="sort-indicator"></span></th>
                                <th class="sortable" data-column="FirstSeenTS">First Seen<span class="sort-indicator"></span></th>
                                <th class="sortable" data-column="BucketDuration_S">Bucket Duration (s)<span class="sort-indicator"></span></th>
                                <th class="sortable" data-column="Rate">Rate (msg/hr)<span class="sort-indicator"></span></th>
                            </tr>
                        </thead>
                        <tbody id="statsBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
        </div>

        <!-- Page: System Info -->
        <div class="page-content" id="page-system">
            <div class="info-container">
                <div class="info-card">
                    <h2>Memory Statistics</h2>
                    <div id="memoryStats" class="stats-grid">
                        <div class="loading">Loading memory statistics...</div>
                    </div>
                </div>
                
                <div class="info-card">
                    <h2>Runtime Information</h2>
                    <div id="runtimeStats" class="stats-grid">
                        <div class="loading">Loading runtime information...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page: Database Info -->
        <div class="page-content" id="page-database">
            <div class="info-container">
                <div class="info-card">
                    <h2>Database Statistics</h2>
                    <div id="dbStats" class="stats-grid">
                        <div class="loading">Loading database statistics...</div>
                    </div>
                </div>

                <div class="info-card">
                    <h2>Storage Information</h2>
                    <div id="storageStats" class="stats-grid">
                        <div class="loading">Loading storage information...</div>
                    </div>
                </div>

                <div class="info-card full-width">
                    <h2>Recent Activity</h2>
                    <div id="recentActivity">
                        <div class="loading">Loading recent activity...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page: Live Stream -->
        <div class="page-content" id="page-stream">
            <div class="stream-container">
                <!-- Filters Panel -->
                <div class="filters-panel">
                    <h2 style="font-size: 16px; margin-top: 0;">Filters</h2>

                    <!-- Filter Buttons at Top -->
                    <div class="filter-buttons" style="margin-top: 0; margin-bottom: 15px;">
                        <button class="btn-apply" onclick="applyFilters()">Apply Filters</button>
                        <button class="btn-reset" onclick="resetFilters()">Reset</button>
                    </div>

                    <!-- Basic Filters -->
                    <div class="filter-section">
                        <h3>Log Levels</h3>
                        <div class="filter-content">
                            <div class="checkbox-group">
                                <label><input type="checkbox" id="level-debug" value="DEBUG"> DEBUG</label>
                                <label><input type="checkbox" id="level-info" value="INFO" checked> INFO</label>
                                <label><input type="checkbox" id="level-warn" value="WARN" checked> WARN</label>
                                <label><input type="checkbox" id="level-error" value="ERROR" checked> ERROR</label>
                                <label><input type="checkbox" id="level-fatal" value="FATAL" checked> FATAL</label>
                            </div>
                        </div>
                    </div>

                    <div class="filter-section">
                        <h3 class="collapsible collapsed">Host Patterns</h3>
                        <div class="filter-content collapsed">
                            <div class="filter-group">
                                <label>Glob patterns (one per line)</label>
                                <textarea id="host-patterns" placeholder="*&#10;prod-*&#10;server-01"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="filter-section">
                        <h3 class="collapsible collapsed">Logger Patterns</h3>
                        <div class="filter-content collapsed">
                            <div class="filter-group">
                                <label>Glob patterns (one per line)</label>
                                <textarea id="logger-patterns" placeholder="*&#10;com.example.*&#10;org.jboss.*"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Filters -->
                    <div class="filter-section">
                        <h3 class="collapsible collapsed">Advanced Filters</h3>
                        <div class="filter-content collapsed">
                            <div class="filter-group">
                                <label>Message Contains (comma-separated)</label>
                                <input type="text" id="message-contains" placeholder="timeout, failed, error">
                            </div>
                            <div class="filter-group">
                                <label>Message Excludes (comma-separated)</label>
                                <input type="text" id="message-excludes" placeholder="debug, trace">
                            </div>
                            <div class="filter-group">
                                <label>Message Regex</label>
                                <input type="text" id="message-regex" placeholder="Exception.*occurred">
                            </div>
                            <div class="filter-group">
                                <label>Stack Trace Mode</label>
                                <select id="stack-trace-mode">
                                    <option value="summary">Summary</option>
                                    <option value="filtered" selected>Filtered</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Stack Trace Include Patterns</label>
                                <textarea id="stack-include" placeholder="com.example.*&#10;org.myapp.*"></textarea>
                            </div>
                            <div class="filter-group">
                                <label>Stack Trace Exclude Patterns</label>
                                <textarea id="stack-exclude" placeholder="org.jboss.*&#10;java.*">org.jboss.*
org.wildfly.*</textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Controls -->
                    <div class="filter-section">
                        <h3 class="collapsible collapsed">Performance</h3>
                        <div class="filter-content collapsed">
                            <div class="filter-group">
                                <label>Rate Limit (msg/sec, 0=unlimited)</label>
                                <input type="number" id="rate-limit" value="0" min="0" max="10000">
                            </div>
                            <div class="filter-group">
                                <label>Batch Timeout (ms, 0=no batching)</label>
                                <input type="number" id="batch-timeout" value="0" min="0" max="5000">
                            </div>
                        </div>
                    </div>

                    <!-- Display Settings -->
                    <div class="filter-section">
                        <h3 class="collapsible collapsed">Display Settings</h3>
                        <div class="filter-content collapsed">
                            <div class="filter-group">
                                <label>Chart Time Window (seconds)</label>
                                <input type="number" id="chart-window" value="300" min="60" max="3600">
                            </div>
                            <div class="filter-group">
                                <label>Chart Bucket Size (seconds)</label>
                                <input type="number" id="chart-bucket" value="20" min="1" max="300">
                            </div>
                            <div class="filter-group">
                                <label>Max Messages to Display</label>
                                <input type="number" id="max-messages" value="10000" min="100" max="50000">
                            </div>
                            <div class="filter-group">
                                <label>Update Interval (ms)</label>
                                <input type="number" id="update-interval" value="250" min="50" max="5000">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="main-content">
                    <!-- Controls Bar -->
                    <div class="controls-bar">
                        <div class="status-indicator">
                            <div class="status-dot disconnected" id="status-dot"></div>
                            <span id="status-text">Disconnected</span>
                        </div>
                        <button onclick="toggleConnection()">Connect</button>
                        <label>
                            <input type="checkbox" id="auto-scroll" checked>
                            Auto-scroll
                        </label>
                        <button onclick="clearMessages()">Clear</button>
                        <div class="stats-info" id="stats-info">
                            Messages: 0 | Clients: 0 | Dropped: 0
                        </div>
                    </div>

                    <!-- Chart -->
                    <div class="chart-container">
                        <div id="frequency-chart" style="width: 100%; height: 100%;"></div>
                    </div>

                    <!-- Messages Table -->
                    <div class="messages-container">
                        <div class="messages-header">
                            <h3>Messages (<span id="message-count">0</span>)</h3>
                        </div>
                        <div class="messages-table-wrapper">
                            <table class="messages-table">
                                <thead>
                                    <tr>
                                        <th style="width: 100px;">Time</th>
                                        <th style="width: 120px;">Host</th>
                                        <th style="width: 150px;">Logger</th>
                                        <th style="width: 80px;">Level</th>
                                        <th>Message</th>
                                        <th style="width: 40px;">Stack</th>
                                    </tr>
                                </thead>
                                <tbody id="messages-tbody">
                                    <tr>
                                        <td colspan="6" style="text-align: center; color: #999;">
                                            No messages yet. Click Connect to start streaming.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for message/stack trace details -->
    <div id="detail-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Message Details</h2>
                <span class="modal-close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="modal-body"></div>
            <div class="modal-buttons">
                <button class="btn-copy" onclick="copyModalContent()">Copy</button>
                <button class="btn-close" onclick="closeModal()">Close</button>
            </div>
        </div>
    </div>

    <script src="/app.js?v=20251217009"></script>
    <script src="/stream.js?v=20251217009"></script>
