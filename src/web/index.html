<!DOCTYPE html>
<html>
<head>
    <title>WildFly Log Statistics</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/style.css">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
</head>
<body>
    <div class="main-container">
        <h1>WildFly Log Statistics</h1>
        
        <!-- Navigation Tabs -->
        <nav class="nav-tabs">
            <button class="nav-tab active" data-page="dashboard">
                <span class="nav-icon">ðŸ“Š</span>
                <span class="nav-label">Dashboard</span>
            </button>
            <button class="nav-tab" data-page="system">
                <span class="nav-icon">ðŸ’»</span>
                <span class="nav-label">System Info</span>
            </button>
            <button class="nav-tab" data-page="database">
                <span class="nav-icon">ðŸ’¾</span>
                <span class="nav-label">Database Info</span>
            </button>
        </nav>

        <!-- Page: Dashboard -->
        <div class="page-content active" id="page-dashboard">
            <div class="content-wrapper">
            <!-- Left Panel: Filters and Settings -->
            <div class="left-panel">
                <!-- Filter Form -->
                <div class="filter-section">
                    <h2>Filter Options</h2>
                    <form id="filterForm">
                        <div class="form-group">
                            <label for="viewMode">View Mode:</label>
                            <select id="viewMode" name="viewMode">
                                <option value="detailed">Detailed (by Logger)</option>
                                <option value="aggregated">Aggregated (Sum by Level)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="level">Level:</label>
                            <select id="level" name="level">
                                <option value="">All Levels</option>
                                <option value="FATAL">FATAL</option>
                                <option value="ERROR">ERROR</option>
                                <option value="WARN">WARN</option>
                                <option value="WARNING">WARNING</option>
                                <option value="INFO">INFO</option>
                                <option value="DEBUG">DEBUG</option>
                                <option value="TRACE">TRACE</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="loggerRegex">Logger Pattern (regex):</label>
                            <input type="text" id="loggerRegex" name="loggerRegex" placeholder="e.g., com\\.example\\..*">
                        </div>
                        <div class="form-group">
                            <label for="minTs">From:</label>
                            <input type="datetime-local" id="minTs" name="minTs">
                        </div>
                        <div class="form-group">
                            <label for="maxTs">To:</label>
                            <input type="datetime-local" id="maxTs" name="maxTs">
                        </div>
                        <div class="form-group">
                            <label for="maxResults">Max Results:</label>
                            <input type="number" id="maxResults" name="maxResults" value="1000" min="1" max="10000">
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="includeMemory" name="includeMemory" checked>
                                Include In-Memory Data
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="includeDB" name="includeDB" checked>
                                Include Database Data
                            </label>
                        </div>
                        <button type="submit" class="btn-primary">Apply Filters</button>
                        <button type="button" class="btn-secondary" id="clearFiltersBtn">Clear Filters</button>
                    </form>
                </div>

                <!-- Auto-Refresh Control -->
                <div class="refresh-section">
                    <h2>Auto-Refresh</h2>
                    <form id="refreshForm">
                        <div class="form-group">
                            <label for="refreshFrequency">Frequency:</label>
                            <select id="refreshFrequency" name="refreshFrequency">
                                <option value="5000">5 seconds</option>
                                <option value="10000">10 seconds</option>
                                <option value="30000">30 seconds</option>
                                <option value="60000">1 minute</option>
                                <option value="300000">5 minutes</option>
                                <option value="600000">10 minutes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="autoRefreshCheckbox">
                                <input type="checkbox" id="autoRefreshCheckbox" name="autoRefresh">
                                Enable Auto-Refresh
                            </label>
                        </div>
                        <button type="button" class="btn-secondary" id="manualRefreshBtn">Manual Refresh</button>
                    </form>
                </div>
            </div>

            <!-- Right Panel: Stats Table -->
            <div class="right-panel">
                <div id="loading" class="loading" style="display: none;">Loading statistics...</div>
                <div id="error" class="error" style="display: none;"></div>

                <!-- Quick Filter Section -->
                <div class="quick-filter-section">
                    <h3>Quick Filter (Client-Side) <span class="filter-status" id="filterStatus"></span></h3>
                    <div class="quick-filter-controls">
                        <input type="text" id="quickSearchInput" placeholder="Search host, logger, or level..." class="quick-filter-input">
                        <select id="quickLevelFilter" class="quick-filter-select">
                            <option value="">All Levels</option>
                            <option value="FATAL">FATAL</option>
                            <option value="ERROR">ERROR</option>
                            <option value="WARN">WARN</option>
                            <option value="WARNING">WARNING</option>
                            <option value="INFO">INFO</option>
                            <option value="DEBUG">DEBUG</option>
                            <option value="TRACE">TRACE</option>
                        </select>
                        <button type="button" class="btn-clear-filter" id="clearQuickFilter">Clear</button>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="charts-wrapper">
                    <!-- Level Distribution Chart -->
                    <div class="chart-section chart-small">
                        <h2>Log Levels Distribution</h2>
                        <div id="levelChart" class="chart-container-small"></div>
                    </div>

                    <!-- Logger Time-Series Chart -->
                    <div class="chart-section chart-large">
                        <div class="chart-header">
                            <h2>Logger Activity Over Time</h2>
                            <div class="logger-selector-controls">
                                <div style="display: flex; gap: 10px;">
                                    <div>
                                        <label style="font-weight: bold; margin-bottom: 5px; display: block;">Loggers:</label>
                                        <select id="loggerSelect" class="logger-multiselect" multiple size="5">
                                            <option disabled>Loading loggers...</option>
                                        </select>
                                        <div class="logger-controls">
                                            <button type="button" class="btn-chart-control" id="selectTopLoggers">Top 5</button>
                                            <button type="button" class="btn-chart-control" id="selectAllLoggers">All</button>
                                            <button type="button" class="btn-chart-control" id="clearLoggers">Clear</button>
                                        </div>
                                    </div>
                                    <div>
                                        <label style="font-weight: bold; margin-bottom: 5px; display: block;">Levels:</label>
                                        <select id="levelSelect" class="logger-multiselect" multiple size="5">
                                            <option value="FATAL">FATAL</option>
                                            <option value="ERROR">ERROR</option>
                                            <option value="WARN">WARN</option>
                                            <option value="WARNING">WARNING</option>
                                            <option value="INFO" selected>INFO</option>
                                            <option value="DEBUG">DEBUG</option>
                                            <option value="TRACE">TRACE</option>
                                        </select>
                                        <div class="logger-controls">
                                            <button type="button" class="btn-chart-control" id="selectAllLevels">All</button>
                                            <button type="button" class="btn-chart-control" id="clearLevels">Clear</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="timeSeriesChart" class="chart-container-large"></div>
                    </div>
                </div>

                <!-- Table Section -->
                <div class="table-section">
                    <h2 id="tableTitle">Log Statistics</h2>
                    <table id="statsTable" style="display: none;">
                        <thead id="statsTableHead">
                            <tr>
                                <th class="sortable" data-column="HostName">Host<span class="sort-indicator"></span></th>
                                <th class="sortable" data-column="Logger">Logger<span class="sort-indicator"></span></th>
                                <th class="sortable" data-column="Level">Level<span class="sort-indicator"></span></th>
                                <th class="sortable" data-column="N">Count<span class="sort-indicator"></span></th>
                                <th class="sortable" data-column="BucketTS">Bucket Start<span class="sort-indicator"></span></th>
                                <th class="sortable" data-column="FirstSeenTS">First Seen<span class="sort-indicator"></span></th>
                                <th class="sortable" data-column="BucketDuration_S">Bucket Duration (s)<span class="sort-indicator"></span></th>
                                <th class="sortable" data-column="Rate">Rate (msg/hr)<span class="sort-indicator"></span></th>
                            </tr>
                        </thead>
                        <tbody id="statsBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
        </div>

        <!-- Page: System Info -->
        <div class="page-content" id="page-system">
            <div class="info-container">
                <div class="info-card">
                    <h2>Memory Statistics</h2>
                    <div id="memoryStats" class="stats-grid">
                        <div class="loading">Loading memory statistics...</div>
                    </div>
                </div>
                
                <div class="info-card">
                    <h2>Runtime Information</h2>
                    <div id="runtimeStats" class="stats-grid">
                        <div class="loading">Loading runtime information...</div>
                    </div>
                </div>

                <div class="info-card full-width">
                    <h2>Memory Usage Chart</h2>
                    <div id="memoryChart" class="chart-container"></div>
                </div>
            </div>
        </div>

        <!-- Page: Database Info -->
        <div class="page-content" id="page-database">
            <div class="info-container">
                <div class="info-card">
                    <h2>Database Statistics</h2>
                    <div id="dbStats" class="stats-grid">
                        <div class="loading">Loading database statistics...</div>
                    </div>
                </div>

                <div class="info-card">
                    <h2>Storage Information</h2>
                    <div id="storageStats" class="stats-grid">
                        <div class="loading">Loading storage information...</div>
                    </div>
                </div>

                <div class="info-card full-width">
                    <h2>Recent Activity</h2>
                    <div id="recentActivity">
                        <div class="loading">Loading recent activity...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/app.js"></script>
</body>
</html>
